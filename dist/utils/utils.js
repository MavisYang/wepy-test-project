'use strict';

var wxUploadFile = require('./uploadFile.js');
var AuthProvider = require('./AuthProvider.js');
var wxRequest = require('./wxRequest.js');
var API = require('./api.js');

// 页面跳转数据字典
// 1:navigateTo  保留当前页面，跳转到应用内的某个页面，使用wx.navigateBack可以返回到原页面  可加参数
// 2:redirectTo 关闭当前页面，跳转到应用内的某个页面。 可加参数
// 3:reLaunch 关闭所有页面，打开到应用内的某个页面。 可加参数
// 4:switchTab 跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面  不可加参数
// 5:navigateBack 关闭当前页面，返回上一页面或多级页面。可通过 getCurrentPages()) 获取当前的页面栈，决定需要返回几层
/**
 * 页面跳转函数
 * @param path 跳转路径 部分可携带参数
 * @param type 跳转类型
 * @param num 是否为返回上级
 */
function pageGo(path, type, num) {
    if (num) {
        wx.navigateBack({
            delta: path
        });
    } else {
        switch (type) {
            case 1:
                wx.navigateTo({
                    url: path
                });
                break;
            case 2:
                wx.redirectTo({
                    url: path
                });
                break;
            case 3:
                wx.reLaunch({
                    url: path
                });
                break;
            case 4:
                wx.switchTab({
                    url: path
                });
                break;
            default:
                break;
        }
    }
}

/**
 * 分享集成函数
 * @param title 分享的标题
 * @param path 分享的页面路径
 * @param imageUrl 分享出去要显示的图片
 * @param callback 分享后的回调
 * @returns {{title: *, path: *, imageUrl: *, success: success, complete: complete}}
 */
function openShare(title, path, imageUrl, callback) {
    return {
        title: title,
        path: path,
        imageUrl: imageUrl,
        success: function success(res) {
            wx.showToast({
                title: '分享成功',
                icon: 'success',
                duration: 3000
            });
        },
        complete: function complete(req) {
            console.log(11);
            callback(req);
        }
    };
}

/**
 *  错误全局提示
 * @param that
 * @param str
 * @constructor
 */
function ErrorTips(that, str, timer) {
    // console.log(that, str, timer,'that, str, timer');
    that.stop = true;
    that.popErrorMsg = str;
    that.$apply();
    hideErrorTips(that, timer);
}

function hideErrorTips(that, timer) {
    var fadeOutTimeout = setTimeout(function () {
        that.popErrorMsg = null;
        that.$apply();
        clearTimeout(fadeOutTimeout);
    }, timer);
}

/**
 * 全局复制函数
 * @param str 需要复制的文字
 */
function copyText(str) {
    wx.setClipboardData({
        data: str,
        success: function success(res) {
            console.log(res);
            successShowText('复制微信号成功');
        }
    });
}

function successShowText(str) {
    wx.showToast({
        title: str,
        icon: 'success',
        duration: 3000
    });
}

function formatZero(str) {
    return str < 10 ? '0' + str : str;
}

function formatTimes(time) {
    var hours = Math.floor(time / 1000 / 60 / 60);
    console.log(hours);
    return formatZero(hours);
}
function formatTime(time, type) {
    var leave1 = time % (24 * 3600);
    var leaves = Math.floor(time / (24 * 3600));
    var hours = Math.floor(leave1 / 3600) + leaves * 24;
    //计算相差分钟数
    var leave2 = leave1 % 3600; //计算小时数后剩余的秒数
    var minutes = Math.floor(leave2 / 60);
    //计算相差秒数
    var leave3 = leave2 % 60;
    return formatZero(hours) + ":" + formatZero(minutes) + ":" + formatZero(leave3);
}

/**
 * 上传图片得到url地址
 * @param imgUrl
 * @param callback
 */
function downloadImg(imgUrl, callback) {
    AuthProvider.getAccessToken().then(function (token) {
        return wxUploadFile.uploadFile(API.uploadImg, imgUrl, token);
    }).then(function (result) {
        var resData = JSON.parse(result.data);
        callback(resData.resultContent);
    });
}

function getOpenId(code, appid) {
    var url = API.getSmallPro + ('?code=' + code + '&appId=' + appid);
    wxRequest.fetch(url, null, null, 'GET').then(function (res) {
        "use strict";

        console.log(res);
        if (res.data.resultCode === '100') {
            wx.setStorageSync('openid', res.data.resultContent.openId);
        }
    });
}

/**
 * 发送formid
 * @param e
 */
function formSubmit(e) {
    var params = {
        "appId": API.APP_ID,
        "formId": e.detail.formId,
        "openId": wx.getStorageSync('openid')
    };
    AuthProvider.getAccessToken().then(function (token) {
        wx.request({
            url: API.templateNews,
            data: params,
            method: 'POST',
            header: {
                'Content-Type': 'application/json;charset=UTF-8',
                "Authorization": 'bearer ' + token //base64加密liz-youli-wx:secret
            },
            success: function success(e) {
                console.log('发送成功');
            }
        });
    });
}

function formSubmits(e) {
    var params = {
        "appId": API.APP_ID,
        "formId": e.detail.formId,
        "openId": wx.getStorageSync('openid')
    };
    wx.request({
        url: API.templateNew,
        data: params,
        method: 'POST',
        header: {
            'Content-Type': 'application/json;charset=UTF-8'
        },
        success: function success(e) {
            console.log('发送成功');
        }
    });
}

/**
 * 倒计时
 * @param that
 * @param total_micro_second
 */
var count_down = function count_down(that, total_micro_second) {
    if (total_micro_second <= 1) {
        that.countTime = "重新获取";
        that.countTimeState = true;
        that.$apply();
        // timeout则跳出递归
        return;
    }
    // 渲染倒计时时钟
    that.countTime = formatZero(date_format(total_micro_second)) + 's后重试';
    that.countTimeState = false;
    that.$apply();
    setTimeout(function () {
        // 放在最后--
        total_micro_second -= 10;
        count_down(that, total_micro_second);
    }, 10);
};

// 时间格式化输出，如03:25:19 86。每10ms都会调用一次
var date_format = function date_format(micro_second) {
    // 秒数
    var second = Math.floor(micro_second / 1000);
    // 小时位
    var hr = Math.floor(second / 3600);
    // 分钟位
    var min = Math.floor((second - hr * 3600) / 60);
    // 秒位
    var sec = second - hr * 3600 - min * 60; // equal to => var sec = second % 60;
    // 毫秒位，保留2位
    var micro_sec = Math.floor(micro_second % 1000 / 10);
    return sec;
};
/**
 * 时间格式化
 */
var DateFuc = {
    getDate: function (_getDate) {
        function getDate(_x) {
            return _getDate.apply(this, arguments);
        }

        getDate.toString = function () {
            return _getDate.toString();
        };

        return getDate;
    }(function (time) {
        if (!time) return '';
        var date = getDate(parseInt(time));
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var day = date.getDate();
        var hour = date.getHours();
        var minute = date.getMinutes();
        var second = date.getSeconds();
        return [year, month, day].map(formatNumber).join('-') + ' ' + [hour, minute].map(formatNumber).join(':');
    })
    /**
     * 补零
     */
};var formatNumber = function formatNumber(n) {
    n = n.toString();
    return n[1] ? n : '0' + n;
};
/**
 *
 * @param time 团购倒计时
 */
function countDownTime(time) {
    var leave1 = time % (24 * 3600);
    var hours = Math.floor(leave1 / 3600);
    //计算相差分钟数
    var leave2 = leave1 % 3600; //计算小时数后剩余的秒数
    var minutes = Math.floor(leave2 / 60);
    //计算相差秒数
    var leave3 = leave2 % 60;
    var seconds = leave3;
    if (hours < 0 || minutes < 0 || seconds < 0) {
        return '00:00:00';
    }
    return formatZero(hours) + ':' + formatZero(minutes) + ':' + formatZero(seconds);
}
/**
 * 验证手机号码
 * @param str
 * @returns {boolean}
 */
function verifyPhone(str) {
    var myreg = /^[1][3,4,5,6,7,8,9][0-9]{9}$/;
    return myreg.test(str);
}

// 初始化时间
function newDate() {
    var date = new Date();
    var year = date.getFullYear();
    var month = date.getMonth() + 1;
    var day = date.getDate();
    return [year, month, day].map(formatNumber).join('-');
}
function newTime() {
    var date = new Date();
    var hour = date.getHours();
    var minute = date.getMinutes();
    var second = date.getSeconds();
    return [hour, minute].map(formatNumber).join(':');
}
module.exports = {
    pageGo: pageGo,
    openShare: openShare,
    ErrorTips: ErrorTips,
    copyText: copyText,
    formatZero: formatZero,
    downloadImg: downloadImg,
    successShowText: successShowText,
    getOpenId: getOpenId,
    formatTime: formatTime,
    formSubmit: formSubmit,
    formSubmits: formSubmits,
    count_down: count_down,
    formatDate: DateFuc.getDate,
    verifyPhone: verifyPhone,
    newDate: newDate,
    newTime: newTime,
    formatTimes: formatTimes,
    countDownTime: countDownTime
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIl0sIm5hbWVzIjpbInd4VXBsb2FkRmlsZSIsInJlcXVpcmUiLCJBdXRoUHJvdmlkZXIiLCJ3eFJlcXVlc3QiLCJBUEkiLCJwYWdlR28iLCJwYXRoIiwidHlwZSIsIm51bSIsInd4IiwibmF2aWdhdGVCYWNrIiwiZGVsdGEiLCJuYXZpZ2F0ZVRvIiwidXJsIiwicmVkaXJlY3RUbyIsInJlTGF1bmNoIiwic3dpdGNoVGFiIiwib3BlblNoYXJlIiwidGl0bGUiLCJpbWFnZVVybCIsImNhbGxiYWNrIiwic3VjY2VzcyIsInJlcyIsInNob3dUb2FzdCIsImljb24iLCJkdXJhdGlvbiIsImNvbXBsZXRlIiwicmVxIiwiY29uc29sZSIsImxvZyIsIkVycm9yVGlwcyIsInRoYXQiLCJzdHIiLCJ0aW1lciIsInN0b3AiLCJwb3BFcnJvck1zZyIsIiRhcHBseSIsImhpZGVFcnJvclRpcHMiLCJmYWRlT3V0VGltZW91dCIsInNldFRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJjb3B5VGV4dCIsInNldENsaXBib2FyZERhdGEiLCJkYXRhIiwic3VjY2Vzc1Nob3dUZXh0IiwiZm9ybWF0WmVybyIsImZvcm1hdFRpbWVzIiwidGltZSIsImhvdXJzIiwiTWF0aCIsImZsb29yIiwiZm9ybWF0VGltZSIsImxlYXZlMSIsImxlYXZlcyIsImxlYXZlMiIsIm1pbnV0ZXMiLCJsZWF2ZTMiLCJkb3dubG9hZEltZyIsImltZ1VybCIsImdldEFjY2Vzc1Rva2VuIiwidGhlbiIsInVwbG9hZEZpbGUiLCJ1cGxvYWRJbWciLCJ0b2tlbiIsInJlc0RhdGEiLCJKU09OIiwicGFyc2UiLCJyZXN1bHQiLCJyZXN1bHRDb250ZW50IiwiZ2V0T3BlbklkIiwiY29kZSIsImFwcGlkIiwiZ2V0U21hbGxQcm8iLCJmZXRjaCIsInJlc3VsdENvZGUiLCJzZXRTdG9yYWdlU3luYyIsIm9wZW5JZCIsImZvcm1TdWJtaXQiLCJlIiwicGFyYW1zIiwiQVBQX0lEIiwiZGV0YWlsIiwiZm9ybUlkIiwiZ2V0U3RvcmFnZVN5bmMiLCJyZXF1ZXN0IiwidGVtcGxhdGVOZXdzIiwibWV0aG9kIiwiaGVhZGVyIiwiZm9ybVN1Ym1pdHMiLCJ0ZW1wbGF0ZU5ldyIsImNvdW50X2Rvd24iLCJ0b3RhbF9taWNyb19zZWNvbmQiLCJjb3VudFRpbWUiLCJjb3VudFRpbWVTdGF0ZSIsImRhdGVfZm9ybWF0IiwibWljcm9fc2Vjb25kIiwic2Vjb25kIiwiaHIiLCJtaW4iLCJzZWMiLCJtaWNyb19zZWMiLCJEYXRlRnVjIiwiZ2V0RGF0ZSIsImRhdGUiLCJwYXJzZUludCIsInllYXIiLCJnZXRGdWxsWWVhciIsIm1vbnRoIiwiZ2V0TW9udGgiLCJkYXkiLCJob3VyIiwiZ2V0SG91cnMiLCJtaW51dGUiLCJnZXRNaW51dGVzIiwiZ2V0U2Vjb25kcyIsIm1hcCIsImZvcm1hdE51bWJlciIsImpvaW4iLCJuIiwidG9TdHJpbmciLCJjb3VudERvd25UaW1lIiwic2Vjb25kcyIsInZlcmlmeVBob25lIiwibXlyZWciLCJ0ZXN0IiwibmV3RGF0ZSIsIkRhdGUiLCJuZXdUaW1lIiwibW9kdWxlIiwiZXhwb3J0cyIsImZvcm1hdERhdGUiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsZUFBZUMsUUFBUSxjQUFSLENBQW5CO0FBQ0EsSUFBSUMsZUFBZUQsUUFBUSxnQkFBUixDQUFuQjtBQUNBLElBQUlFLFlBQVlGLFFBQVEsYUFBUixDQUFoQjtBQUNBLElBQUlHLE1BQU1ILFFBQVEsT0FBUixDQUFWOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQSxTQUFTSSxNQUFULENBQWdCQyxJQUFoQixFQUFzQkMsSUFBdEIsRUFBNEJDLEdBQTVCLEVBQWlDO0FBQzdCLFFBQUlBLEdBQUosRUFBUztBQUNMQyxXQUFHQyxZQUFILENBQWdCO0FBQ1pDLG1CQUFPTDtBQURLLFNBQWhCO0FBR0gsS0FKRCxNQUlPO0FBQ0gsZ0JBQVFDLElBQVI7QUFDSSxpQkFBSyxDQUFMO0FBQ0lFLG1CQUFHRyxVQUFILENB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QkFBYUEsV0FOQTtBQU9iYixxQkFBaUJBLGVBUEo7QUFRYnlCLGVBQVdBLFNBUkU7QUFTYmxCLGdCQUFZQSxVQVRDO0FBVWIwQixnQkFBWUEsVUFWQztBQVdiVyxpQkFBYUEsV0FYQTtBQVliRSxnQkFBWUEsVUFaQztBQWFid0MsZ0JBQVk3QixRQUFRQyxPQWJQO0FBY2JvQixpQkFBYUEsV0FkQTtBQWViRyxhQUFTQSxPQWZJO0FBZ0JiRSxhQUFTQSxPQWhCSTtBQWlCYmpGLGlCQUFhQSxXQWpCQTtBQWtCYjBFLG1CQUFlQTtBQWxCRixDQUFqQiIsImZpbGUiOiJ1dGlscy5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCB3eFVwbG9hZEZpbGUgPSByZXF1aXJlKCcuL3VwbG9hZEZpbGUnKTtcbmxldCBBdXRoUHJvdmlkZXIgPSByZXF1aXJlKCcuL0F1dGhQcm92aWRlcicpO1xubGV0IHd4UmVxdWVzdCA9IHJlcXVpcmUoJy4vd3hSZXF1ZXN0Jyk7XG5sZXQgQVBJID0gcmVxdWlyZSgnLi9hcGknKTtcblxuLy8g6aG16Z2i6Lez6L2s5pWw5o2u5a2X5YW4XG4vLyAxOm5hdmlnYXRlVG8gIOS/neeVmeW9k+WJjemhtemdou+8jOi3s+i9rOWIsOW6lOeUqOWGheeahOafkOS4qumhtemdou+8jOS9v+eUqHd4Lm5hdmlnYXRlQmFja+WPr+S7pei/lOWbnuWIsOWOn+mhtemdoiAg5Y+v5Yqg5Y+C5pWwXG4vLyAyOnJlZGlyZWN0VG8g5YWz6Zet5b2T5YmN6aG16Z2i77yM6Lez6L2s5Yiw5bqU55So5YaF55qE5p+Q5Liq6aG16Z2i44CCIOWPr+WKoOWPguaVsFxuLy8gMzpyZUxhdW5jaCDlhbPpl63miYDmnInpobXpnaLvvIzmiZPlvIDliLDlupTnlKjlhoXnmoTmn5DkuKrpobXpnaLjgIIg5Y+v5Yqg5Y+C5pWwXG4vLyA0OnN3aXRjaFRhYiDot7PovazliLAgdGFiQmFyIOmhtemdou+8jOW5tuWFs+mXreWFtuS7luaJgOaciemdniB0YWJCYXIg6aG16Z2iICDkuI3lj6/liqDlj4LmlbBcbi8vIDU6bmF2aWdhdGVCYWNrIOWFs+mXreW9k+WJjemhtemdou+8jOi/lOWbnuS4iuS4gOmhtemdouaIluWkmue6p+mhtemdouOAguWPr+mAmui/hyBnZXRDdXJyZW50UGFnZXMoKSkg6I635Y+W5b2T5YmN55qE6aG16Z2i5qCI77yM5Yaz5a6a6ZyA6KaB6L+U5Zue5Yeg5bGCXG4vKipcbiAqIOmhtemdoui3s+i9rOWHveaVsFxuICogQHBhcmFtIHBhdGgg6Lez6L2s6Lev5b6EIOmDqOWIhuWPr+aQuuW4puWPguaVsFxuICogQHBhcmFtIHR5cGUg6Lez6L2s57G75Z6LXG4gKiBAcGFyYW0gbnVtIOaYr+WQpuS4uui/lOWbnuS4iue6p1xuICovXG5mdW5jdGlvbiBwYWdlR28ocGF0aCwgdHlwZSwgbnVtKSB7XG4gICAgaWYgKG51bSkge1xuICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soe1xuICAgICAgICAgICAgZGVsdGE6IHBhdGhcbiAgICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXRoXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgd3gucmVkaXJlY3RUbyh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogcGF0aFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgIHd4LnJlTGF1bmNoKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXRoXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgd3guc3dpdGNoVGFiKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXRoXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICog5YiG5Lqr6ZuG5oiQ5Ye95pWwXG4gKiBAcGFyYW0gdGl0bGUg5YiG5Lqr55qE5qCH6aKYXG4gKiBAcGFyYW0gcGF0aCDliIbkuqvnmoTpobXpnaLot6/lvoRcbiAqIEBwYXJhbSBpbWFnZVVybCDliIbkuqvlh7rljrvopoHmmL7npLrnmoTlm77niYdcbiAqIEBwYXJhbSBjYWxsYmFjayDliIbkuqvlkI7nmoTlm57osINcbiAqIEByZXR1cm5zIHt7dGl0bGU6ICosIHBhdGg6ICosIGltYWdlVXJsOiAqLCBzdWNjZXNzOiBzdWNjZXNzLCBjb21wbGV0ZTogY29tcGxldGV9fVxuICovXG5mdW5jdGlvbiBvcGVuU2hhcmUodGl0bGUsIHBhdGgsIGltYWdlVXJsLCBjYWxsYmFjaykge1xuICAgIHJldHVybiB7XG4gICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgaW1hZ2VVcmw6IGltYWdlVXJsLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiAn5YiG5Lqr5oiQ5YqfJyxcbiAgICAgICAgICAgICAgICBpY29uOiAnc3VjY2VzcycsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDMwMDBcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAocmVxKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygxMSlcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlcSlcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiAg6ZSZ6K+v5YWo5bGA5o+Q56S6XG4gKiBAcGFyYW0gdGhhdFxuICogQHBhcmFtIHN0clxuICogQGNvbnN0cnVjdG9yXG4gKi9cbmZ1bmN0aW9uIEVycm9yVGlwcyh0aGF0LCBzdHIsIHRpbWVyKSB7XG4gICAgLy8gY29uc29sZS5sb2codGhhdCwgc3RyLCB0aW1lciwndGhhdCwgc3RyLCB0aW1lcicpO1xuICAgIHRoYXQuc3RvcCA9IHRydWU7XG4gICAgdGhhdC5wb3BFcnJvck1zZyA9IHN0cjtcbiAgICB0aGF0LiRhcHBseSgpO1xuICAgIGhpZGVFcnJvclRpcHModGhhdCx0aW1lcik7XG59XG5cbmZ1bmN0aW9uIGhpZGVFcnJvclRpcHModGhhdCwgdGltZXIpIHtcbiAgICBsZXQgZmFkZU91dFRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhhdC5wb3BFcnJvck1zZyA9IG51bGw7XG4gICAgICAgIHRoYXQuJGFwcGx5KCk7XG4gICAgICAgIGNsZWFyVGltZW91dChmYWRlT3V0VGltZW91dCk7XG4gICAgfSwgdGltZXIpO1xufVxuXG4vKipcbiAqIOWFqOWxgOWkjeWItuWHveaVsFxuICogQHBhcmFtIHN0ciDpnIDopoHlpI3liLbnmoTmloflrZdcbiAqL1xuZnVuY3Rpb24gY29weVRleHQoc3RyKSB7XG4gICAgd3guc2V0Q2xpcGJvYXJkRGF0YSh7XG4gICAgICAgIGRhdGE6IHN0cixcbiAgICAgICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XG4gICAgICAgICAgICBzdWNjZXNzU2hvd1RleHQoJ+WkjeWItuW+ruS/oeWPt+aIkOWKnycpXG4gICAgICAgIH1cbiAgICB9KVxufVxuXG5mdW5jdGlvbiBzdWNjZXNzU2hvd1RleHQoc3RyKSB7XG4gICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgdGl0bGU6IHN0cixcbiAgICAgICAgaWNvbjogJ3N1Y2Nlc3MnLFxuICAgICAgICBkdXJhdGlvbjogMzAwMFxuICAgIH0pXG59XG5cbmZ1bmN0aW9uIGZvcm1hdFplcm8oc3RyKSB7XG4gICAgcmV0dXJuIHN0ciA8IDEwID8gJzAnICsgc3RyIDogc3RyO1xufVxuXG5mdW5jdGlvbiBmb3JtYXRUaW1lcyh0aW1lKSB7XG4gICAgdmFyIGhvdXJzID0gTWF0aC5mbG9vcih0aW1lIC8gMTAwMCAvIDYwIC8gNjApO1xuICAgIGNvbnNvbGUubG9nKGhvdXJzKVxuICAgIHJldHVybiBmb3JtYXRaZXJvKGhvdXJzKVxufVxuZnVuY3Rpb24gZm9ybWF0VGltZSh0aW1lLCB0eXBlKSB7XG4gICAgdmFyIGxlYXZlMSA9IHRpbWUgJSAoMjQgKiAzNjAwKTtcbiAgICB2YXIgbGVhdmVzID0gTWF0aC5mbG9vcih0aW1lIC8gKDI0ICogMzYwMCkpO1xuICAgIHZhciBob3VycyA9IE1hdGguZmxvb3IobGVhdmUxIC8gMzYwMCkgKyBsZWF2ZXMgKiAyNDtcbiAgICAvL+iuoeeul+ebuOW3ruWIhumSn+aVsFxuICAgIHZhciBsZWF2ZTIgPSBsZWF2ZTEgJSAzNjAwOyAgICAgICAvL+iuoeeul+Wwj+aXtuaVsOWQjuWJqeS9meeahOenkuaVsFxuICAgIHZhciBtaW51dGVzID0gTWF0aC5mbG9vcihsZWF2ZTIgLyA2MCk7XG4gICAgLy/orqHnrpfnm7jlt67np5LmlbBcbiAgICB2YXIgbGVhdmUzID0gbGVhdmUyICUgNjA7XG4gICAgcmV0dXJuIGZvcm1hdFplcm8oaG91cnMpICsgXCI6XCIgKyBmb3JtYXRaZXJvKG1pbnV0ZXMpICsgXCI6XCIgKyBmb3JtYXRaZXJvKGxlYXZlMylcbn1cblxuLyoqXG4gKiDkuIrkvKDlm77niYflvpfliLB1cmzlnLDlnYBcbiAqIEBwYXJhbSBpbWdVcmxcbiAqIEBwYXJhbSBjYWxsYmFja1xuICovXG5mdW5jdGlvbiBkb3dubG9hZEltZyhpbWdVcmwsIGNhbGxiYWNrKSB7XG4gICAgQXV0aFByb3ZpZGVyLmdldEFjY2Vzc1Rva2VuKCkudGhlbih0b2tlbiA9PiB7XG4gICAgICAgIHJldHVybiB3eFVwbG9hZEZpbGUudXBsb2FkRmlsZShBUEkudXBsb2FkSW1nLCBpbWdVcmwsIHRva2VuKTtcbiAgICB9KS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgIGxldCByZXNEYXRhID0gSlNPTi5wYXJzZShyZXN1bHQuZGF0YSk7XG4gICAgICAgIGNhbGxiYWNrKHJlc0RhdGEucmVzdWx0Q29udGVudCk7XG4gICAgfSlcbn1cblxuZnVuY3Rpb24gZ2V0T3BlbklkKGNvZGUsIGFwcGlkKSB7XG4gICAgbGV0IHVybCA9IEFQSS5nZXRTbWFsbFBybyArIGA/Y29kZT0ke2NvZGV9JmFwcElkPSR7YXBwaWR9YDtcbiAgICB3eFJlcXVlc3QuZmV0Y2godXJsLCBudWxsLCBudWxsLCAnR0VUJykudGhlbihyZXMgPT4ge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKTtcbiAgICAgICAgaWYgKHJlcy5kYXRhLnJlc3VsdENvZGUgPT09ICcxMDAnKSB7XG4gICAgICAgICAgICB3eC5zZXRTdG9yYWdlU3luYygnb3BlbmlkJywgcmVzLmRhdGEucmVzdWx0Q29udGVudC5vcGVuSWQpO1xuICAgICAgICB9XG4gICAgfSlcbn1cblxuLyoqXG4gKiDlj5HpgIFmb3JtaWRcbiAqIEBwYXJhbSBlXG4gKi9cbmZ1bmN0aW9uIGZvcm1TdWJtaXQoZSkge1xuICAgIGxldCBwYXJhbXMgPSB7XG4gICAgICAgIFwiYXBwSWRcIjogQVBJLkFQUF9JRCxcbiAgICAgICAgXCJmb3JtSWRcIjogZS5kZXRhaWwuZm9ybUlkLFxuICAgICAgICBcIm9wZW5JZFwiOiB3eC5nZXRTdG9yYWdlU3luYygnb3BlbmlkJylcbiAgICB9O1xuICAgIEF1dGhQcm92aWRlci5nZXRBY2Nlc3NUb2tlbigpLnRoZW4odG9rZW4gPT4ge1xuICAgICAgICB3eC5yZXF1ZXN0KHtcbiAgICAgICAgICAgIHVybDogQVBJLnRlbXBsYXRlTmV3cyxcbiAgICAgICAgICAgIGRhdGE6IHBhcmFtcyxcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLTgnLFxuICAgICAgICAgICAgICAgIFwiQXV0aG9yaXphdGlvblwiOiAnYmVhcmVyICcgKyB0b2tlbiAvL2Jhc2U2NOWKoOWvhmxpei15b3VsaS13eDpzZWNyZXRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCflj5HpgIHmiJDlip8nKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH0pXG5cbn1cblxuZnVuY3Rpb24gZm9ybVN1Ym1pdHMoZSkge1xuICAgIGxldCBwYXJhbXMgPSB7XG4gICAgICAgIFwiYXBwSWRcIjogQVBJLkFQUF9JRCxcbiAgICAgICAgXCJmb3JtSWRcIjogZS5kZXRhaWwuZm9ybUlkLFxuICAgICAgICBcIm9wZW5JZFwiOiB3eC5nZXRTdG9yYWdlU3luYygnb3BlbmlkJylcbiAgICB9O1xuICAgIHd4LnJlcXVlc3Qoe1xuICAgICAgICB1cmw6IEFQSS50ZW1wbGF0ZU5ldyxcbiAgICAgICAgZGF0YTogcGFyYW1zLFxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOCcsXG4gICAgICAgIH0sXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygn5Y+R6YCB5oiQ5YqfJylcbiAgICAgICAgfVxuICAgIH0pXG5cbn1cblxuLyoqXG4gKiDlgJLorqHml7ZcbiAqIEBwYXJhbSB0aGF0XG4gKiBAcGFyYW0gdG90YWxfbWljcm9fc2Vjb25kXG4gKi9cbnZhciBjb3VudF9kb3duID0gZnVuY3Rpb24gKHRoYXQsIHRvdGFsX21pY3JvX3NlY29uZCkge1xuICAgIGlmICh0b3RhbF9taWNyb19zZWNvbmQgPD0gMSkge1xuICAgICAgICB0aGF0LmNvdW50VGltZSA9IFwi6YeN5paw6I635Y+WXCI7XG4gICAgICAgIHRoYXQuY291bnRUaW1lU3RhdGUgPSB0cnVlO1xuICAgICAgICB0aGF0LiRhcHBseSgpO1xuICAgICAgICAvLyB0aW1lb3V05YiZ6Lez5Ye66YCS5b2SXG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8g5riy5p+T5YCS6K6h5pe25pe26ZKfXG4gICAgdGhhdC5jb3VudFRpbWUgPSBmb3JtYXRaZXJvKGRhdGVfZm9ybWF0KHRvdGFsX21pY3JvX3NlY29uZCkpICsgJ3PlkI7ph43or5UnO1xuICAgIHRoYXQuY291bnRUaW1lU3RhdGUgPSBmYWxzZTtcbiAgICB0aGF0LiRhcHBseSgpO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyDmlL7lnKjmnIDlkI4tLVxuICAgICAgICB0b3RhbF9taWNyb19zZWNvbmQgLT0gMTA7XG4gICAgICAgIGNvdW50X2Rvd24odGhhdCwgdG90YWxfbWljcm9fc2Vjb25kKTtcbiAgICB9LCAxMClcbn1cblxuLy8g5pe26Ze05qC85byP5YyW6L6T5Ye677yM5aaCMDM6MjU6MTkgODbjgILmr48xMG1z6YO95Lya6LCD55So5LiA5qyhXG52YXIgZGF0ZV9mb3JtYXQgPSBmdW5jdGlvbiAobWljcm9fc2Vjb25kKSB7XG4gICAgLy8g56eS5pWwXG4gICAgdmFyIHNlY29uZCA9IE1hdGguZmxvb3IobWljcm9fc2Vjb25kIC8gMTAwMCk7XG4gICAgLy8g5bCP5pe25L2NXG4gICAgdmFyIGhyID0gTWF0aC5mbG9vcihzZWNvbmQgLyAzNjAwKTtcbiAgICAvLyDliIbpkp/kvY1cbiAgICB2YXIgbWluID0gTWF0aC5mbG9vcigoc2Vjb25kIC0gaHIgKiAzNjAwKSAvIDYwKTtcbiAgICAvLyDnp5LkvY1cbiAgICB2YXIgc2VjID0gKHNlY29uZCAtIGhyICogMzYwMCAtIG1pbiAqIDYwKTsgLy8gZXF1YWwgdG8gPT4gdmFyIHNlYyA9IHNlY29uZCAlIDYwO1xuICAgIC8vIOavq+enkuS9je+8jOS/neeVmTLkvY1cbiAgICB2YXIgbWljcm9fc2VjID0gTWF0aC5mbG9vcigobWljcm9fc2Vjb25kICUgMTAwMCkgLyAxMCk7XG4gICAgcmV0dXJuIHNlYztcbn1cbi8qKlxuICog5pe26Ze05qC85byP5YyWXG4gKi9cbnZhciBEYXRlRnVjID0ge1xuICAgIGdldERhdGU6IGZ1bmN0aW9uICh0aW1lKSB7XG4gICAgICAgIGlmICghdGltZSkgcmV0dXJuICcnO1xuICAgICAgICB2YXIgZGF0ZSA9IGdldERhdGUocGFyc2VJbnQodGltZSkpO1xuICAgICAgICB2YXIgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKVxuICAgICAgICB2YXIgbW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxXG4gICAgICAgIHZhciBkYXkgPSBkYXRlLmdldERhdGUoKVxuICAgICAgICB2YXIgaG91ciA9IGRhdGUuZ2V0SG91cnMoKVxuICAgICAgICB2YXIgbWludXRlID0gZGF0ZS5nZXRNaW51dGVzKClcbiAgICAgICAgdmFyIHNlY29uZCA9IGRhdGUuZ2V0U2Vjb25kcygpXG4gICAgICAgIHJldHVybiBbeWVhciwgbW9udGgsIGRheV0ubWFwKGZvcm1hdE51bWJlcikuam9pbignLScpICsgJyAnICsgW2hvdXIsIG1pbnV0ZV0ubWFwKGZvcm1hdE51bWJlcikuam9pbignOicpXG4gICAgfVxufVxuLyoqXG4gKiDooaXpm7ZcbiAqL1xudmFyIGZvcm1hdE51bWJlciA9IGZ1bmN0aW9uIChuKSB7XG4gICAgbiA9IG4udG9TdHJpbmcoKVxuICAgIHJldHVybiBuWzFdID8gbiA6ICcwJyArIG5cbn1cbi8qKlxuICpcbiAqIEBwYXJhbSB0aW1lIOWboui0reWAkuiuoeaXtlxuICovXG5mdW5jdGlvbiBjb3VudERvd25UaW1lKHRpbWUpIHtcbiAgICB2YXIgbGVhdmUxID0gdGltZSAlICgyNCAqIDM2MDApXG4gICAgdmFyIGhvdXJzID0gTWF0aC5mbG9vcihsZWF2ZTEgLyAzNjAwKTtcbiAgICAvL+iuoeeul+ebuOW3ruWIhumSn+aVsFxuICAgIHZhciBsZWF2ZTIgPSBsZWF2ZTEgJSAzNjAwICAgICAgIC8v6K6h566X5bCP5pe25pWw5ZCO5Ymp5L2Z55qE56eS5pWwXG4gICAgdmFyIG1pbnV0ZXMgPSBNYXRoLmZsb29yKGxlYXZlMiAvIDYwKVxuICAgIC8v6K6h566X55u45beu56eS5pWwXG4gICAgdmFyIGxlYXZlMyA9IGxlYXZlMiAlIDYwXG4gICAgdmFyIHNlY29uZHMgPSBsZWF2ZTNcbiAgICBpZiAoaG91cnMgPCAwIHx8IG1pbnV0ZXMgPCAwIHx8IHNlY29uZHMgPCAwKSB7XG4gICAgICAgIHJldHVybiAnMDA6MDA6MDAnXG4gICAgfVxuICAgIHJldHVybiBmb3JtYXRaZXJvKGhvdXJzKSArICc6JyArIGZvcm1hdFplcm8obWludXRlcykgKyAnOicgKyBmb3JtYXRaZXJvKHNlY29uZHMpXG59XG4vKipcbiAqIOmqjOivgeaJi+acuuWPt+eggVxuICogQHBhcmFtIHN0clxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIHZlcmlmeVBob25lKHN0cikge1xuICAgIGxldCBteXJlZyA9IC9eWzFdWzMsNCw1LDYsNyw4LDldWzAtOV17OX0kLztcbiAgICByZXR1cm4gbXlyZWcudGVzdChzdHIpO1xufVxuXG4vLyDliJ3lp4vljJbml7bpl7RcbmZ1bmN0aW9uIG5ld0RhdGUoKSB7XG4gICAgbGV0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIHZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpXG4gICAgdmFyIG1vbnRoID0gZGF0ZS5nZXRNb250aCgpICsgMVxuICAgIHZhciBkYXkgPSBkYXRlLmdldERhdGUoKVxuICAgIHJldHVybiBbeWVhciwgbW9udGgsIGRheV0ubWFwKGZvcm1hdE51bWJlcikuam9pbignLScpXG59XG5mdW5jdGlvbiBuZXdUaW1lKCkge1xuICAgIGxldCBkYXRlID0gbmV3IERhdGUoKTtcbiAgICB2YXIgaG91ciA9IGRhdGUuZ2V0SG91cnMoKVxuICAgIHZhciBtaW51dGUgPSBkYXRlLmdldE1pbnV0ZXMoKVxuICAgIHZhciBzZWNvbmQgPSBkYXRlLmdldFNlY29uZHMoKVxuICAgIHJldHVybiBbaG91ciwgbWludXRlXS5tYXAoZm9ybWF0TnVtYmVyKS5qb2luKCc6Jylcbn1cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIHBhZ2VHbzogcGFnZUdvLFxuICAgIG9wZW5TaGFyZTogb3BlblNoYXJlLFxuICAgIEVycm9yVGlwczogRXJyb3JUaXBzLFxuICAgIGNvcHlUZXh0OiBjb3B5VGV4dCxcbiAgICBmb3JtYXRaZXJvOiBmb3JtYXRaZXJvLFxuICAgIGRvd25sb2FkSW1nOiBkb3dubG9hZEltZyxcbiAgICBzdWNjZXNzU2hvd1RleHQ6IHN1Y2Nlc3NTaG93VGV4dCxcbiAgICBnZXRPcGVuSWQ6IGdldE9wZW5JZCxcbiAgICBmb3JtYXRUaW1lOiBmb3JtYXRUaW1lLFxuICAgIGZvcm1TdWJtaXQ6IGZvcm1TdWJtaXQsXG4gICAgZm9ybVN1Ym1pdHM6IGZvcm1TdWJtaXRzLFxuICAgIGNvdW50X2Rvd246IGNvdW50X2Rvd24sXG4gICAgZm9ybWF0RGF0ZTogRGF0ZUZ1Yy5nZXREYXRlLFxuICAgIHZlcmlmeVBob25lOiB2ZXJpZnlQaG9uZSxcbiAgICBuZXdEYXRlOiBuZXdEYXRlLFxuICAgIG5ld1RpbWU6IG5ld1RpbWUsXG4gICAgZm9ybWF0VGltZXM6IGZvcm1hdFRpbWVzLFxuICAgIGNvdW50RG93blRpbWU6IGNvdW50RG93blRpbWVcbn07XG4iXX0=